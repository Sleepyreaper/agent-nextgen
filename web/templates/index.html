{% extends "base.html" %}

{% block title %}NextGen Dashboard - Application Evaluation{% endblock %}

{% block content %}
<div style="background: linear-gradient(135deg, rgba(0,51,102,0.05) 0%, rgba(0,153,169,0.05) 100%); padding: 2rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid var(--accent-teal);">
    <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap;">
        <h2 style="color: var(--emory-blue); margin-bottom: 0.5rem;">NextGen High School Internship Program</h2>
    </div>
    <p style="color: #555;">Our mission: Recognizing that our differences make us stronger, we actively recruit and support learners from all backgrounds in STEM to improve outcomes for our entire community.</p>
</div>

<div class="stats">
    <div class="stat-card">
        <div class="stat-value" style="color: var(--emory-blue);">{{ pending_count }}</div>
        <div class="stat-label">Pending Review</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: var(--accent-teal);">{{ evaluated_count }}</div>
        <div class="stat-label">Evaluated</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: var(--emory-gold);">{{ total_count }}</div>
        <div class="stat-label">Total Students</div>
    </div>
</div>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid #eee; padding-bottom: 1rem;">
        <h2 style="color: var(--emory-blue);">ðŸ“‹ Recent Applications</h2>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <a href="{{ url_for('students') }}" class="btn btn-secondary">ðŸ‘¥ View All Students</a>
            <a href="{{ url_for('upload') }}" class="btn btn-success">+ Add New Student</a>
        </div>
    </div>

    <!-- Recent Student List Component -->
    {% set students = students %}
    {% include '_student_list.html' %}
    
    <div style="margin-top: 2rem; text-align: center;">
        <a href="{{ url_for('students') }}" class="btn" style="display: inline-block;">
            View All {{ total_count }} Students â†’
        </a>
    </div>
</div>


{% endblock %}

{% block extra_js %}
<script>
async function evaluateOne(button) {
    if (!confirm('Evaluate this application with AI?')) return;
    
    const applicationId = button.dataset.appId;
    button.disabled = true;
    button.textContent = 'Evaluating...';
    
    try {
        const response = await fetch(`/evaluate/${applicationId}`, { method: 'POST' });
        const data = await response.json();
        
        if (response.ok) {
            alert(`Evaluation complete!\nScore: ${data.overall_score}/100\nRecommendation: ${data.recommendation}`);
            location.reload();
        } else {
            alert(`Error: ${data.error}`);
            btn.disabled = false;
            btn.textContent = 'Evaluate';
        }
    } catch (error) {
        alert(`Error: ${error.message}`);
        btn.disabled = false;
        btn.textContent = 'Evaluate';
    }
}

async function evaluateAll() {
    if (!confirm('Evaluate all pending applications? This may take a few minutes.')) return;
    
    const btn = event.target;
    btn.disabled = true;
    btn.textContent = 'Evaluating...';
    
    try {
        const response = await fetch('/evaluate_all', { method: 'POST' });
        const data = await response.json();
        
        if (response.ok) {
            alert(`Evaluated ${data.evaluations.length} applications!`);
            location.reload();
        } else {
            alert(`Error: ${data.error}`);
            btn.disabled = false;
            btn.textContent = 'ðŸ¤– Evaluate All Pending';
        }
    } catch (error) {
        alert(`Error: ${error.message}`);
        btn.disabled = false;
        btn.textContent = 'ðŸ¤– Evaluate All Pending';
    }
}
</script>
{% endblock %}
